import{u as q,a as G,t as C,c as f,r as p,w as K,b as v,o as r,d,e as m,n as P,F as y,f as M,g as b,h as Q,i,j as g,k as Y,l as B,s as R}from"./index-eb6e241d.js";import{h as T}from"./moment-fbc5633a.js";import"./browser-ponyfill-2fa155e1.js";const Z="/assets/middle-earth-aa6967af.svg";const ee={class:"c-tracker"},te=m("img",{src:Z},null,-1),ae=["viewBox"],le=["d"],ne=["d"],oe={key:1,class:"user-pin-plane"},se=["src"],ue={class:"sidebar"},re=["onSubmit"],ie=["src"],de=m("div",{id:"bunt-teleport-target"},null,-1),_e={__name:"Tracker",setup(ce){const U=q(),$=G(),L=R,S=C(L,"user"),n=C(L,"activeJourney"),x=f(()=>{if(!n.value)return;const a=[];let e;for(const[s,l]of n.value.legs.entries())e&&(l.path||s===n.value.legs.length-1)&&e.travelledDistance>0&&e.travelledDistance<e.totalDistance&&(e.style={"--travelled-distance-ratio":e.travelledDistance/e.totalDistance}),l.path?(e={d:l.path,totalDistance:0,travelledDistance:0},a.push(e)):(e.totalDistance+=l.distance,e.travelledDistance+=l.distance-l.remainingDistance);return a});let w=p([]),D=f(()=>{if(w.value.length!==0)for(const[a,e]of x.value.entries()){if(e.travelledDistance===e.totalDistance)continue;const s=w.value[a],l=s.getTotalLength()*e.travelledDistance/e.totalDistance,u=s.getPointAtLength(l);return{x:u.x/n.value.paths_viewbox.width,y:u.y/n.value.paths_viewbox.height}}}),j=f(()=>{if(D.value)return{"--user-x":D.value.x,"--user-y":D.value.y}}),k=p(2),_=p({x:0,y:0}),c=p(null),F=f(()=>c.value?1/(c.value.getBoundingClientRect().height/2400):void 0),N=f(()=>({"--zoom":k.value,"--pan-x":_.value.x,"--pan-y":_.value.y,"--svg-scale":F.value}));function z(a){k.value=Math.max(1,k.value-a.deltaY/1e3)}function A(a){a.preventDefault(),c.value.setPointerCapture(a.pointerId);let e={x:a.clientX,y:a.clientY};function s(u){u.preventDefault(),_.value={x:_.value.x+(u.clientX-e.x),y:_.value.y+(u.clientY-e.y)},e={x:u.clientX,y:u.clientY}}function l(u){c.value.removeEventListener("pointermove",s),c.value.removeEventListener("pointerup",l)}c.value.addEventListener("pointermove",s),c.value.addEventListener("pointerup",l)}let V=p(!1),h=p($.name),o=p(null);function X(){V.value=!0,o.value={date:T().format("YYYY-MM-DDTHH:mm"),distance:0,mode:"walk",comment:""}}async function H(){await R.createEntry({...o.value,date:T(o.value.date).toISOString()}),V.value=!1}return K(()=>h.value,()=>{U.push({name:h.value})}),(a,e)=>{const s=v("bunt-input"),l=v("bunt-select"),u=v("bunt-button"),E=v("bunt-tab"),I=v("bunt-tabs"),W=v("router-view"),J=v("bunt-icon-button"),O=v("router-link");return r(),d(y,null,[m("div",ee,[m("div",{class:"map",ref_key:"mapEl",ref:c,style:P(N.value),onWheelPassive:z,onPointerdown:A},[te,n.value?(r(),d("svg",{key:0,class:"paths",viewBox:`${n.value.paths_viewbox.x} ${n.value.paths_viewbox.y} ${n.value.paths_viewbox.width} ${n.value.paths_viewbox.height}`},[(r(!0),d(y,null,M(x.value,t=>(r(),d("path",{class:"remaining",ref_for:!0,ref_key:"pathEls",ref:w,d:t.d},null,8,le))),256)),(r(!0),d(y,null,M(x.value,t=>(r(),d(y,null,[t.travelledDistance>0?(r(),d("path",{key:0,d:t.d,style:P(t.style),pathLength:"1"},null,12,ne)):b("",!0)],64))),256))],8,ae)):b("",!0),n.value?(r(),d("div",oe,[m("div",{class:"user-pin",style:P(j.value)},[m("img",{src:S.value.profile.avatar_url},null,8,se)],4)])):b("",!0)],36),m("div",ue,[V.value?(r(),d("form",{key:0,class:"add-entry",onSubmit:Q(H,["prevent"])},[i(s,{modelValue:o.value.distance,"onUpdate:modelValue":e[0]||(e[0]=t=>o.value.distance=t),name:"distance",label:"Distance",type:"number",hint:"in meters"},null,8,["modelValue"]),i(s,{modelValue:o.value.date,"onUpdate:modelValue":e[1]||(e[1]=t=>o.value.date=t),name:"date",label:"Date",type:"datetime-local",placeholder:" "},null,8,["modelValue"]),i(l,{modelValue:o.value.mode,"onUpdate:modelValue":e[2]||(e[2]=t=>o.value.mode=t),name:"mode",label:"Mode",options:["walk","ride"]},null,8,["modelValue"]),i(s,{modelValue:o.value.comment,"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.comment=t),name:"comment",label:"Comment"},null,8,["modelValue"]),i(u,{id:"btn-create-entry",type:"submit"},{default:g(()=>[B("Create Entry")]),_:1})],40,re)):(r(),Y(I,{key:1,modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=t=>h.value=t)},{default:g(()=>[i(E,{id:"journey",header:"journey"}),i(E,{id:"log",header:"log"}),i(E,{id:"fellowship",header:"fellowship"})]),_:1},8,["modelValue"])),i(W),h.value!=="fellowship"?(r(),Y(J,{key:2,id:"btn-add-entry",onClick:X},{default:g(()=>[B("plus")]),_:1})):b("",!0)]),i(O,{class:"profile-link",to:{name:"profile"}},{default:g(()=>[m("img",{src:S.value.profile.avatar_url},null,8,ie)]),_:1})]),de],64)}}};export{_e as default};
